#navigation
  #nav_toggle.open.transparent
  #app_title.ui-helper-clearfix
    - begin
      = render file: File.join(Rails.root, 'app', 'views', 'wulin_master', '_app_title')
    - rescue ActionView::MissingTemplate
      = render '/app_title'
  #menu{style: "top: #{WulinMaster.config.app_title_height}"}
    %ul
      - controller.menu.each do |menu_entry|
        - if menu_entry.is_submenu?
          %li.submenu
            %a{:href => "#"}
              %span.indicator
              = menu_entry.title
            %ul
              - menu_entry.each do |submenu_entry|
                %li.item{:style => submenu_entry.is_hidden? ? "display:none" : ""}
                  = link_to submenu_entry.title, submenu_entry.path, data: {'active-url' => submenu_entry.active_paths, 'wiki_screen' => submenu_entry.wiki_screen}
                  %span.screen_wiki.hidden
                    =image_tag('i.png')
        - else
          %li.item
            = link_to menu_entry.title, menu_entry.path, data: {'active-url' => menu_entry.active_paths, 'wiki_screen' => menu_entry.wiki_screen}
            %span.screen_wiki.hidden
              =image_tag('i.png')
  
  - if defined?(WulinOAuth) and User.current_user
    #user_nav
      #user_email
        = User.current_user.email
        = link_to image_tag('logout.jpg'), "#{WulinOAuth.configuration['logout_uri']}?redirect_uri=#{logout_url}", title: 'Logout', class: 'btn logout-btn'
      
  - elsif defined?(WulinAuth) and current_user
    #user_nav
      #user_email
        = current_user.email
        = link_to image_tag('logout.jpg'), logout_path, title: 'Logout', class: 'btn logout-btn'

  
  #activity
    #indicators

:javascript
  $(function(){
    $("li.item span.screen_wiki").addClass("hidden");
    $("li.item.active span.screen_wiki").removeClass("hidden");

    $("li.item a").on('click', function(){
      $("li.item span.screen_wiki").addClass("hidden");
      $(this).siblings("span.screen_wiki").removeClass("hidden");
    });

    $("span.screen_wiki").off("click").on("click", function(e){
      var screen_name = $(this).siblings("a").data("wiki-screen");
      var action = $.extend({screen_name: screen_name}, WulinMaster.actions.ScreenWiki);
      action.handler();
    });
  });